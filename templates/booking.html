{% extends "base.html" %}

{% block title %}CropMarket - Farming App{% endblock %}

{% block head_extra %}
<script>
// Pass user data to the base template
console.log('Setting user data in sessionStorage...');
console.log('User email:', '{{ user_email or "user@example.com" }}');
console.log('User name:', '{{ user_name or "User" }}');

// Store user data in sessionStorage for the base template
sessionStorage.setItem('userEmail', '{{ user_email or "user@example.com" }}');
sessionStorage.setItem('userPhone', '{{ user_phone or "" }}');
sessionStorage.setItem('userName', '{{ user_name or "User" }}');
sessionStorage.setItem('userLocation', '{{ user_location or "" }}');
sessionStorage.setItem('userBio', '{{ user_bio or "" }}');

console.log('User data stored:', {
    email: sessionStorage.getItem('userEmail'),
    name: sessionStorage.getItem('userName'),
    phone: sessionStorage.getItem('userPhone')
});

// Force navigation update after setting user data
setTimeout(() => {
    console.log('Forcing navigation update after user data is set...');
    if (typeof updateNavigation === 'function') {
        console.log('Calling updateNavigation...');
        updateNavigation();
    } else {
        console.log('updateNavigation function not available yet, trying again...');
        setTimeout(() => {
            if (typeof updateNavigation === 'function') {
                updateNavigation();
            }
        }, 200);
    }
}, 50);

</script>
{% endblock %}

{% block content %}
<div class="booking-page">
    <!-- Search Bar -->
    <div class="search-container">
        <div class="search-wrapper">
            <input type="text" placeholder="Search crops..." class="search-input">
        </div>
    </div>

    <!-- Action Buttons Section -->
    <div class="action-buttons-section">
        <div class="action-buttons-container">
            <a href="/market" class="action-btn market-btn">
                <span class="btn-icon">📊</span>
                <span class="btn-text">Market Updates</span>
            </a>
            <a href="/sell" class="action-btn sell-btn">
                <span class="btn-icon">🌾</span>
                <span class="btn-text">Sell Crops</span>
            </a>
            <a href="/buy" class="action-btn buy-btn">
                <span class="btn-icon">🛒</span>
                <span class="btn-text">Buy Crops</span>
            </a>
        </div>
    </div>


    <!-- Instagram-style Feed -->
    <div class="insta-feed">
        <!-- Stories Section -->
        <div class="stories-section">
            <div class="story-item add-story">
                <div class="story-avatar">
                    <span>+</span>
                </div>
                <span class="story-name">Your Story</span>
            </div>
            <div class="story-item">
                <div class="story-avatar">
                    <span>🌾</span>
                </div>
                <span class="story-name">Wheat</span>
            </div>
            <div class="story-item">
                <div class="story-avatar">
                    <span>🌽</span>
                </div>
                <span class="story-name">Corn</span>
            </div>
            <div class="story-item">
                <div class="story-avatar">
                    <span>🍅</span>
                </div>
                <span class="story-name">Tomatoes</span>
            </div>
            <div class="story-item">
                <div class="story-avatar">
                    <span>🥕</span>
                </div>
                <span class="story-name">Carrots</span>
            </div>
        </div>


        <!-- Welcome Section -->
        <div class="welcome-section">
            <div class="welcome-card">
                <h2>🌱 Welcome to Your Farming Dashboard</h2>
                <p>Choose an action below to get started with your agricultural activities:</p>
                <div class="welcome-features">
                    <div class="feature-item">
                        <span class="feature-icon">📊</span>
                        <h3>Market Updates</h3>
                        <p>Stay informed with latest agricultural market trends and prices</p>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">🌾</span>
                        <h3>Sell Crops</h3>
                        <p>List your harvest and connect with potential buyers</p>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">🛒</span>
                        <h3>Buy Crops</h3>
                        <p>Find and purchase fresh crops from local farmers</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Initialize user data from backend
document.addEventListener('DOMContentLoaded', function() {
    // Store user data in sessionStorage
    sessionStorage.setItem('userEmail', '{{ user_email or "user@example.com" }}');
    sessionStorage.setItem('userPhone', '{{ user_phone or "" }}');
    sessionStorage.setItem('userName', '{{ user_name or "User" }}');
    sessionStorage.setItem('userLocation', '{{ user_location or "" }}');
    sessionStorage.setItem('userBio', '{{ user_bio or "" }}');
    
    // Initialize profile display
    if (typeof updateProfileInitials === 'function') {
        updateProfileInitials('{{ user_name or "User" }}');
    }
});
</script>
{% endblock %}

{% block modals %}
<!-- Modals are defined in base.html to avoid duplicate IDs -->
{% endblock %}
